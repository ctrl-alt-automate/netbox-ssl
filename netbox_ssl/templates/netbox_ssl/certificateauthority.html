{% extends 'generic/object.html' %}
{% load helpers %}
{% load plugins %}
{% load i18n %}

{% block breadcrumbs %}
  {{ block.super }}
  <li class="breadcrumb-item">
    <a href="{% url 'plugins:netbox_ssl:certificateauthority_list' %}">Certificate Authorities</a>
  </li>
{% endblock breadcrumbs %}

{% block content %}
<div class="row mb-3">
  <div class="col col-md-6">
    <div class="card">
      <h5 class="card-header">Certificate Authority Details</h5>
      <div class="card-body">
        <table class="table table-hover attr-table">
          <tr>
            <th scope="row">Name</th>
            <td>{{ object.name }}</td>
          </tr>
          <tr>
            <th scope="row">Type</th>
            <td>{% badge object.get_type_display %}</td>
          </tr>
          <tr>
            <th scope="row">Approved</th>
            <td>
              {% if object.is_approved %}
                <span class="badge text-bg-success">Approved</span>
              {% else %}
                <span class="badge text-bg-warning">Not Approved</span>
              {% endif %}
            </td>
          </tr>
          <tr>
            <th scope="row">Certificates Issued</th>
            <td>{{ certificates_count }}</td>
          </tr>
        </table>
      </div>
    </div>
  </div>
  <div class="col col-md-6">
    <div class="card">
      <h5 class="card-header">Contact Information</h5>
      <div class="card-body">
        <table class="table table-hover attr-table">
          <tr>
            <th scope="row">Website</th>
            <td>
              {% if object.website_url %}
                <a href="{{ object.website_url }}" target="_blank" rel="noopener noreferrer">{{ object.website_url }}</a>
              {% else %}
                <span class="text-muted">Not specified</span>
              {% endif %}
            </td>
          </tr>
          <tr>
            <th scope="row">Portal URL</th>
            <td>
              {% if object.portal_url %}
                <a href="{{ object.portal_url }}" target="_blank" rel="noopener noreferrer">{{ object.portal_url }}</a>
              {% else %}
                <span class="text-muted">Not specified</span>
              {% endif %}
            </td>
          </tr>
          <tr>
            <th scope="row">Contact Email</th>
            <td>
              {% if object.contact_email %}
                <a href="mailto:{{ object.contact_email }}">{{ object.contact_email }}</a>
              {% else %}
                <span class="text-muted">Not specified</span>
              {% endif %}
            </td>
          </tr>
        </table>
      </div>
    </div>
    <div class="card mt-3">
      <h5 class="card-header">Auto-Detection</h5>
      <div class="card-body">
        <table class="table table-hover attr-table">
          <tr>
            <th scope="row">Issuer Pattern</th>
            <td>
              {% if object.issuer_pattern %}
                <code>{{ object.issuer_pattern }}</code>
              {% else %}
                <span class="text-muted">Not configured</span>
              {% endif %}
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>
</div>

{% if object.description %}
<div class="row mb-3">
  <div class="col col-12">
    <div class="card">
      <h5 class="card-header">Description</h5>
      <div class="card-body">
        {{ object.description|linebreaks }}
      </div>
    </div>
  </div>
</div>
{% endif %}

{% if certificates %}
<div class="row mb-3">
  <div class="col col-12">
    <div class="card">
      <h5 class="card-header">Recent Certificates ({{ certificates_count }} total)</h5>
      <div class="card-body">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Common Name</th>
              <th>Status</th>
              <th>Valid To</th>
              <th>Days Remaining</th>
            </tr>
          </thead>
          <tbody>
            {% for cert in certificates %}
            <tr>
              <td>
                <a href="{{ cert.get_absolute_url }}">{{ cert.common_name }}</a>
              </td>
              <td>{% badge cert.get_status_display bg_color=cert.get_status_color %}</td>
              <td>{{ cert.valid_to|date:"Y-m-d" }}</td>
              <td>
                {% if cert.days_remaining < 0 %}
                  <span class="badge text-bg-danger">Expired</span>
                {% elif cert.days_remaining <= 14 %}
                  <span class="badge text-bg-danger">{{ cert.days_remaining }} days</span>
                {% elif cert.days_remaining <= 30 %}
                  <span class="badge text-bg-warning">{{ cert.days_remaining }} days</span>
                {% else %}
                  <span class="badge text-bg-success">{{ cert.days_remaining }} days</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% if certificates_count > 10 %}
        <a href="{% url 'plugins:netbox_ssl:certificate_list' %}?issuing_ca_id={{ object.pk }}" class="btn btn-sm btn-primary">
          View All {{ certificates_count }} Certificates
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}

{% endblock content %}
