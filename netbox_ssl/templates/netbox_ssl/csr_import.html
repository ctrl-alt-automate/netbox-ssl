{% extends 'generic/object_edit.html' %}
{% load form_helpers %}
{% load i18n %}

{% block title %}Import CSR{% endblock %}

{% block breadcrumbs %}
  <li class="breadcrumb-item">
    <a href="{% url 'plugins:netbox_ssl:certificate_list' %}">SSL Certificates</a>
  </li>
  <li class="breadcrumb-item">
    <a href="{% url 'plugins:netbox_ssl:certificatesigningrequest_list' %}">CSRs</a>
  </li>
  <li class="breadcrumb-item active" aria-current="page">Import</li>
{% endblock breadcrumbs %}

{% block content %}
<div class="row">
  <div class="col col-md-8">
    <div class="card">
      <h5 class="card-header">
        <i class="mdi mdi-upload"></i> Import CSR (Smart Paste)
      </h5>
      <div class="card-body">
        <form method="post" class="form">
          {% csrf_token %}

          <div class="alert alert-info">
            <h6><i class="mdi mdi-information"></i> Instructions</h6>
            <ul class="mb-0">
              <li>Paste your Certificate Signing Request (CSR) in PEM format below</li>
              <li>CSRs contain only the public key - no private key data</li>
              <li>Duplicate CSRs (same fingerprint) will be rejected</li>
              <li>Optionally specify who requested this certificate and the target CA</li>
            </ul>
          </div>

          <div class="mb-3">
            <label for="id_pem_content" class="form-label">CSR (PEM format) *</label>
            {{ form.pem_content }}
            {% if form.pem_content.help_text %}
              <div class="form-text">{{ form.pem_content.help_text }}</div>
            {% endif %}
            {% if form.pem_content.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.pem_content.errors %}{{ error }}{% endfor %}
              </div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label for="id_requested_by" class="form-label">Requested By</label>
            {{ form.requested_by }}
            {% if form.requested_by.help_text %}
              <div class="form-text">{{ form.requested_by.help_text }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label for="id_target_ca" class="form-label">Target CA</label>
            {{ form.target_ca }}
            {% if form.target_ca.help_text %}
              <div class="form-text">{{ form.target_ca.help_text }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label for="id_tenant" class="form-label">Tenant</label>
            {{ form.tenant }}
            {% if form.tenant.help_text %}
              <div class="form-text">{{ form.tenant.help_text }}</div>
            {% endif %}
          </div>

          <div class="text-end">
            <a href="{% url 'plugins:netbox_ssl:certificatesigningrequest_list' %}" class="btn btn-outline-secondary">
              Cancel
            </a>
            <button type="submit" class="btn btn-primary">
              <i class="mdi mdi-upload"></i> Import CSR
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col col-md-4">
    <div class="card">
      <h5 class="card-header">Example PEM Format</h5>
      <div class="card-body">
        <pre class="mb-0"><code>-----BEGIN CERTIFICATE REQUEST-----
MIICijCCAXICAQAwRTELMAkGA1UE...
(base64 encoded data)
...hvcNAQkOMTUwMzAJBgNVHRME
-----END CERTIFICATE REQUEST-----</code></pre>
      </div>
    </div>

    <div class="card mt-3">
      <h5 class="card-header">
        <i class="mdi mdi-information text-info"></i> About CSRs
      </h5>
      <div class="card-body">
        <p class="mb-0">
          A Certificate Signing Request (CSR) contains the public key and subject
          information that will be used by a Certificate Authority to issue a certificate.
          CSRs are generated by the server or client that needs the certificate.
        </p>
      </div>
    </div>

    <div class="card mt-3">
      <h5 class="card-header">
        <i class="mdi mdi-file-document text-primary"></i> Parsed Fields
      </h5>
      <div class="card-body">
        <ul class="mb-0 small">
          <li>Common Name (CN)</li>
          <li>Organization (O)</li>
          <li>Organizational Unit (OU)</li>
          <li>Locality (L)</li>
          <li>State/Province (ST)</li>
          <li>Country (C)</li>
          <li>Subject Alternative Names</li>
          <li>Key Algorithm & Size</li>
          <li>SHA256 Fingerprint</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock content %}
